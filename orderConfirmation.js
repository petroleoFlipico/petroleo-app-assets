"use strict";(()=>{var D=document.querySelector("#cart-button"),ie=document.querySelector("#added-to-cart"),N={};async function E(){try{let n=await(await fetch("https://petroleo-app.onrender.com/api/cart",{credentials:"include"})).json();if(!Array.isArray(n))throw new Error("Received data is not an array");return n}catch(t){return console.error("Failed to fetch cart items:",t),[]}}async function P(){D?.classList.remove("hide");let t=document.querySelector(".state-default"),n=document.querySelector(".state-empty"),o=document.querySelector(".state-error");try{let e=await E(),s=e.reduce((r,l)=>r+l.price*l.quantity,0),a=document.getElementById("cart-total");a&&(a.style.display="block",a.textContent=`${s.toFixed(2)} z\u0142 + VAT`);let i=document.getElementById("cart-quantity");if(i){let r=e.reduce((l,d)=>l+d.quantity,0);i.textContent=r.toString()}t&&n&&o&&(e.length>0?(n.style.display="none",o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="none",n.style.display="flex")),await W(e)}catch(e){console.error("Failed to update cart UI:",e),t&&n&&o&&(n.style.display="none",t.style.display="none",o.style.display="flex")}}async function B(t,n=null){try{let o=n==="null"?null:n,e=await fetch(`https://petroleo-app.onrender.com/api/cart/${t}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({variant:o})});if(!e.ok)throw new Error(`Failed to remove item: ${e.statusText}`);window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"remove_from_cart",ecommerce:{items:[{item_id:t,item_name:t,affiliation:"Konferencja App"}]}}),await P()}catch(o){console.error("Failed to remove item from cart:",o)}}async function T(t,n,o=null){try{let e=await fetch(`https://petroleo-app.onrender.com/api/cart/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({variant:o==="null"?null:o,quantity:n,attendeeName:N[t]||[]})});if(!e.ok)throw new Error(`Failed to update item quantity: ${e.statusText}`);window.location.href.includes("koszyk")||await P()}catch(e){console.error("Failed to update item quantity:",e)}}function V(){document.addEventListener("change",async t=>{let n=t.target;if(!n.classList.contains("is-quantity"))return;let o=parseInt(n.value,10),e=n.closest(".cart-item"),s=e?.querySelector(".deletebutton")?.getAttribute("data-item-id"),a=e?.querySelector(".deletebutton")?.getAttribute("data-variant")||null;s&&o>0&&await T(s,o,a)})}async function W(t){let n=document.querySelector(".cart-list");if(!n)return;n.innerHTML="",t.forEach((e,s)=>{let a=document.createElement("div");a.className="cart-item",a.innerHTML=`
            <div class="cart-product-info" style="white-space: nowrap">
                <div class="margin-bottom margin-custom5">    
                    <span class="text-weight-semibold text-style-2lines" style="text-wrap: initial">${e.ticketType.toUpperCase()}</span>
                </div>
                <div class="cart-product-parameter" style="display: ${e.variant!==null?"flex":"none"}">
                    <div class="display-inline">Wariant:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.variant}</div>
                </div>
                
                <div class="cart-product-parameter">
                    <div class="display-inline">Cena:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.price} z\u0142 + VAT</div>
                </div>

                <div class="cart-product-parameter">
                    <div class="display-inline">Ilo\u015B\u0107:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.quantity}</div>
                </div>
            </div>
            <div class="card-product-form w-form">
                <input class="form_input is-quantity w-input" data-input="quantity" maxlength="256" value="${e.quantity}" type="number">
            </div>
            <button class="button-6 deletebutton" data-item-id="${e.id}" data-variant="${e.variant}">
                <div class="icon-1x1-xsmall">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M18 6l-12 12"></path>
                        <path d="M6 6l12 12"></path>
                    </svg>
                </div>
            </button>
        `,n.appendChild(a)}),V(),document.querySelectorAll(".deletebutton").forEach(e=>{e.addEventListener("click",async s=>{let a=s.currentTarget,i=a.getAttribute("data-item-id"),r=a.getAttribute("data-variant")||null;i?await B(i,r):console.error("Failed to remove item from cart: missing item ID")})})}function H(t,n){let o=document.createElement("select");o.classList.add("form_input"),o.dataset.input="variant",o.setAttribute("validate","true");let e=document.createElement("option");return e.value="",e.disabled=!0,e.selected=!0,e.textContent=t,o.appendChild(e),n.forEach(({value:s,label:a})=>{let i=document.createElement("option");i.value=s,i.textContent=a,o.appendChild(i)}),R(o),o}function R(t){t.style.appearance="none",t.style.setProperty("-webkit-appearance","none"),t.style.setProperty("-moz-appearance","none"),t.style.paddingRight="2.5rem",t.style.boxSizing="border-box";let n=`<svg width="10" height="6" viewBox="0 0 10 6"
      xmlns="http://www.w3.org/2000/svg"><path d="M0 0l5 6 5-6z" fill="#333"/></svg>`;t.style.backgroundImage=`url("data:image/svg+xml;charset=UTF-8,${encodeURIComponent(n)}")`,t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="right 1rem center"}function I(t,n){let o=[{value:"Rynek polski",label:"Rynek polski"},{value:"Rynek zagraniczny",label:"Rynek zagraniczny"}],e=[{value:"Szczecin",label:"Szczecin"},{value:"Gda\u0144sk",label:"Gda\u0144sk"},{value:"Bydgoszcz",label:"Bydgoszcz"},{value:"Pozna\u0144",label:"Pozna\u0144"}];document.querySelectorAll(".order-item-list").forEach((a,i)=>{a&&(a.innerHTML="",t.forEach(r=>{let l=document.createElement("div");if(l.className="order-item",l.innerHTML=`
                <span class="text-weight-semibold text-style-2lines" style="text-wrap: initial">${r.ticketType.toUpperCase()}</span>
            `,n===1&&i===0){let d=r.ticketType;if(d==="VIP"||d==="Premium"||d==="Standard"||d==="Objazd\xF3wka Standard"||d==="Objazd\xF3wka Premium"){let p=document.createElement("div");if(p.className="cart-product-parameter",r.variant!==null)p.innerHTML=`
                <div class="display-inline">Wariant:</div>
                <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${r.variant}</div>
            `;else{p.style.marginBottom="0.5rem";let m=null;d==="VIP"?m=H("Wybierz rodzaj warsztat\xF3w",o):(d==="Objazd\xF3wka Standard"||d==="Objazd\xF3wka Premium")&&(m=H("Wybierz miasto",e)),m&&(m.value=r.variant||"",p.innerHTML='<div class="display-inline">Wariant:</div>',p.appendChild(m),m.addEventListener("change",async()=>{r.variant=m.value,await T(r.id,r.quantity,r.variant),m.disabled=!0,m.style.cursor="not-allowed"}))}l.appendChild(p)}let c=document.createElement("div");c.className="cart-product-parameter",Array.isArray(r.attendeeName)||(r.attendeeName=[]);let u=()=>{c.innerHTML="";for(let p=0;p<r.quantity;p++){let m=document.createElement("input");m.className="form_input w-input attendee-name",m.type="text",m.placeholder=`Imi\u0119 i nazwisko #${p+1}`,m.required=!0,m.dataset.ticketId=r.id,m.dataset.attendeeIndex=`${p}`,m.value=r.attendeeName?.[p]||"",m.addEventListener("input",()=>{r.attendeeName||(r.attendeeName=[]),r.attendeeName[p]=m.value,N[r.id]=[...r.attendeeName]}),c.appendChild(m)}};u(),l.appendChild(c);let y=document.createElement("div");y.className="cart-product-parameter",y.innerHTML=`
        <div class="display-inline">Ilo\u015B\u0107:</div>
        <input class="form_input is-quantity w-input" data-input="quantity" maxlength="256" value="${r.quantity}" type="number" min="1">
    `;let v=document.createElement("div");v.className="cart-product-parameter",v.innerHTML=`
        <div class="display-inline">Cena:</div>
        <div class="display-inline text-weight-semibold text-color-brand">${(r.price*r.quantity).toFixed(2)} z\u0142 + VAT</div>
    `;let g=y.querySelector('input[data-input="quantity"]');g?.addEventListener("input",async()=>{let p=parseInt(g.value,10);if(p>0){if(r.quantity=p,!r.attendeeName||r.attendeeName.length>p)r.attendeeName&&(r.attendeeName=r.attendeeName.slice(0,p));else for(;r.attendeeName.length<p;)r.attendeeName.push("");u(),await T(r.id,p,r.variant),K(v,r.price,p)}}),l.appendChild(y),l.appendChild(v)}else n===2&&i===1&&((r.attendeeName||[]).forEach((c,u)=>{l.innerHTML+=`
            <div class="cart-product-parameter">
                <div class="display-inline" style="white-space: nowrap">Imi\u0119 i nazwisko #${u+1}:</div>
                <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${c}</div>
            </div>
        `}),r.variant!==null&&(l.innerHTML+=`
            <div class="cart-product-parameter">
                <div class="display-inline">Wariant:</div>
                <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${r.variant}</div>
            </div>
        `),l.innerHTML+=`
        <div class="cart-product-parameter">
            <div class="display-inline">Cena:</div>
            <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${r.price} z\u0142 + VAT</div>
        </div>
        <div class="cart-product-parameter">
            <div class="display-inline">Ilo\u015B\u0107:</div>
            <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${r.quantity}</div>
        </div>
    `);a.appendChild(l)}))})}function K(t,n,o){let e=t.querySelector(".text-weight-semibold.text-color-brand");e&&(e.textContent=`${(n*o).toFixed(2)} z\u0142 + VAT`)}function A(t){document.querySelectorAll(".order-item-list").forEach(o=>{o&&(o.innerHTML="",t.forEach(e=>{let s=document.createElement("div");s.className="order-item",s.innerHTML=`
          <span class="text-weight-semibold text-style-2lines" style="text-wrap: initial">${e.ticketType.toUpperCase()}</span>
        `,e.variant!==null&&(s.innerHTML+=`
            <div class="cart-product-parameter">
              <div class="display-inline">Wariant:</div>
              <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.variant}</div>
            </div>
          `);let a=[];Array.isArray(e.attendeeName)?a=e.attendeeName:typeof e.attendeeName=="string"&&(a=[e.attendeeName]),a.forEach((i,r)=>{let l=document.createElement("div");l.className="cart-product-parameter",l.innerHTML=`
                    <div class="display-inline">Imi\u0119 i nazwisko #${r+1}:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${i}</div>
                `,s.appendChild(l)}),s.innerHTML+=`
          <div class="cart-product-parameter">
            <div class="display-inline">Cena:</div>
            <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.price} z\u0142 + VAT</div>
          </div>

          <div class="cart-product-parameter">
            <div class="display-inline">Ilo\u015B\u0107:</div>
            <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${e.quantity}</div>
          </div>
        `,o.appendChild(s)}))})}var L=async t=>{try{let n=await fetch("https://petroleo-app.onrender.com/api/retrieve-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({paymentIntent:t})});if(!n.ok)throw new Error(`API error! status: ${n.status}`);return(await n.json()).paymentIntentResult}catch{return null}};async function j(){try{await fetch("https://petroleo-app.onrender.com/api/cart",{method:"DELETE",credentials:"include"})}catch(t){console.error("Failed to clear cart:",t)}}async function _(){try{return(await(await fetch("https://petroleo-app.onrender.com/api/session-id",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json()).sessionID}catch(t){return console.error("B\u0142\u0105d podczas pobierania ID sesji:",t),null}}function U(){let t=document.querySelectorAll('select[data-input="variant"][validate="true"]'),n=!0;return t.forEach(o=>{o.value===""&&(alert("Prosz\u0119 wybra\u0107 wariant warsztat\xF3w przed przej\u015Bciem dalej."),n=!1)}),n}var J=()=>{let t=document.querySelector("#Email")?.value||"",n=document.querySelector("#wf-ecom-shipping-name")?.value||"",o=document.querySelector("#nip")?.value||"",e=document.querySelector("#Telefon")?.value||"",s=document.querySelector("#DodatkoweInformacje")?.value||"",a=document.querySelector("#nazwa-firmy")?.value||"",i=document.querySelector("#Adres-Firmy")?.value||"",r=document.querySelector("#address-line1")?.value||"",l=document.querySelector("#address-line2")?.value||"",d=document.querySelector("#city")?.value||"",c=document.querySelector("#state")?.value||"",u=document.querySelector("#postal-code")?.value||"",y=document.querySelector("#country")?.value||"PL";return{email:t,name:n,nip:o,phone:e,additionalInfo:s,companyName:a,companyAddress:i,addressLine1:r,addressLine2:l,city:d,state:c,postalCode:u,country:y}},Q=t=>/^\d{10}$/.test(t),S=(t,n)=>!t||t.value.trim()===""?(alert(`Prosz\u0119 uzupe\u0142ni\u0107 pole: ${n}.`),!1):!0,G=()=>{let t=document.querySelector("#Company"),n=document.querySelector("#nip"),o=document.querySelector("#nazwa-firmy"),e=document.querySelector("#Adres-Firmy");return t?.checked?(n?.value?Q(n.value.trim()):!0)?S(n,"NIP")&&S(o,"Nazwa firmy")&&S(e,"Adres firmy"):(alert("Podany NIP jest niepoprawny."),!1):!0},Y=()=>{if(!G())return!1;let o=document.querySelector('div[data-step="1"]')?.querySelectorAll("input[required], select[required]");if(!Array.from(o||[]).every(i=>i.value.trim()!==""))return alert("Prosz\u0119 uzupe\u0142ni\u0107 wszystkie wymagane pola."),!1;if(document.querySelector("#is-items")?.value!=="true")return alert("Koszyk musi zawiera\u0107 przedmioty."),!1;let a=document.querySelectorAll("input.attendee-name");for(let i of a)if(!i.value.trim())return alert("Prosz\u0119 wpisa\u0107 imi\u0119 i nazwisko dla ka\u017Cdego biletu."),!1;return!0},Z=()=>{let t=document.querySelector('div[data-step="1"]'),n=document.querySelector("#is-items");if(n&&(n.value=String(!0)),!t)return;t.querySelectorAll("input[required], select[required]").forEach(s=>{s.addEventListener("input",b)}),t.querySelectorAll("input.attendee-name").forEach(s=>{s.addEventListener("input",b)}),n?.addEventListener("input",b),b()},k=(t,n,o,e)=>{let s=document.querySelector(".products-cost");s&&(s.textContent=`${t.toFixed(2)} z\u0142 + VAT`);let a=document.querySelector(".coupon-amount");a&&a.parentElement&&(e>0?(a.parentElement.style.display="block",a.textContent=`${e.toFixed(2)} z\u0142`):a.parentElement.style.display="none");let i=document.querySelector(".tax");i&&(i.textContent=`${n.toFixed(2)} z\u0142`);let r=document.querySelector(".total-cost");r&&(r.textContent=`${o.toFixed(2)} z\u0142`)},C=(t,n)=>(t.reduce((e,s)=>e+s.price*s.quantity,0)-n).toFixed(2),X=document.querySelector('a[data-form="next-btn"]'),$=document.querySelector('div[data-step="1"]'),F=document.querySelector('div[data-step="2"]'),x=document.querySelector("#Company"),f=document.querySelector(".company-info");f&&(f.style.display="none");var O=f?.querySelectorAll("input"),q=document.querySelector("#nip");q?.removeAttribute("required");x&&f&&O&&x.addEventListener("change",()=>{x.checked?(f.style.display="flex",q?.setAttribute("required","true")):(f.style.display="none",O.forEach(t=>t.value=""),q?.removeAttribute("required"))});var b=()=>{let t=document.querySelector('a[data-form="next-btn"]'),n=document.querySelector('div[data-step="1"]'),o=document.querySelector("#is-items");if(!n||!t||!o)return;let e=n.querySelectorAll("input[required], select[required]"),s=n.querySelectorAll("input.attendee-name"),a=[],i=[];e.forEach(u=>{if(u.value.trim()===""){let y=u.closest(".form-group")?.querySelector("label")?.textContent?.trim()||u.name||u.id;a.push(y)}}),s.forEach((u,y)=>{u.value.trim()===""&&i.push(`Bilet #${y+1}`)});let r=o.value==="true",l=a.length===0,d=i.length===0,c=l&&d&&r;console.clear(),c?console.log("\u2705 Wszystkie dane s\u0105 poprawne. Przycisk \u201EDalej\u201D dost\u0119pny."):(console.group("\u{1F512} Przycisk \u201EDalej\u201D zablokowany \u2013 brakuje:"),r||console.warn('\u{1F6D2} Koszyk jest pusty (isItemsInput !== "true")'),a.length>0&&console.warn("\u{1F4C4} Pola wymagane:",a),i.length>0&&console.warn("\u{1F465} Imiona i nazwiska brakuj\u0105ce:",i),console.groupEnd()),t.disabled=!c,t.style.cursor=c?"pointer":"not-allowed",t.style.opacity=c?"1":"0.5",t.style.pointerEvents=c?"auto":"none",t.style.display=c?"block":"none"},ee=async()=>{$&&F?($.style.display="none",F.style.display="flex",window.scrollTo({top:0,behavior:"smooth"})):console.error("One of the step wrappers is not found.")},te=async(t,n,o,e,s,a,i)=>{try{return console.log("Sending to backend:",s),await(await fetch("https://petroleo-app.onrender.com/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({products_cost:Math.round(t*100),tax_cost:Math.round(n*100),total_amount:Math.round(o*100),coupon_amount:Math.round(e*100),currency:"PLN",items:s.flatMap(l=>Array.from({length:l.quantity},(d,c)=>({id:l.id,ticketType:l.ticketType,quantity:1,price:l.price,variant:l.variant||null,attendeeName:l.attendeeName?.[c]||""}))),customer_email:a.email,customer_name:a.name,nip:a.nip,phone:a.phone,additional_info:a.additionalInfo,company_name:a.companyName,company_address:a.companyAddress,sessionID:i})})).json()}catch(r){return console.error("Error creating payment intent:",r),null}};async function ne(t){let n=document.querySelector('div[data-output="nip"]'),o=document.querySelector('div[data-output="company-name"]'),e=document.querySelector('div[data-output="company-address"]');t.nip!==""&&n&&o&&e?(n.textContent=t.nip,o.textContent=t.companyName,e.textContent=t.companyAddress):t.nip===""&&n&&n.parentElement&&(n.parentElement.style.display="none")}var ae=async()=>{let t=window.Stripe?.("pk_test_51RdVZ203pAaMeUO4sSCM4gxQJo3oXr2dMCS6BZoCKeVsYJFaFxI9mQqnVS3mCtCO8Yi9Q0KUK53v3Kn8wwlnAEpm00tnDJLG47",{stripeAccount:"acct_"});if(!t){console.error("Stripe nie zosta\u0142o zainicjalizowane.");return}let n=document.querySelector('[data-element="payment_form"]');if(n)n.addEventListener("keydown",a=>{a.key==="Enter"&&a.preventDefault()});else{console.error("Payment form element could not be found. Ensure that the form has the correct data-element attribute.");return}let o=await E();if(o.length===0&&window.location.pathname.includes("/koszyk")){alert("Tw\xF3j koszyk jest pusty. Dodaj przedmioty do koszyka."),window.location.href="/";return}Z();let e=async a=>{try{return await(await fetch("https://petroleo-app.onrender.com/api/validate-coupon",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({couponCode:a})})).json()}catch(i){return console.error("Error checking coupon:",i),{isValid:!1,discountType:null,amount:0}}},s=0;document.getElementById("apply-coupon")?.addEventListener("click",async()=>{let a=document.getElementById("coupon-code"),i=document.getElementById("coupon-feedback");if(!a||!i){console.error("Nie znaleziono elementu formularza kuponu.");return}let r=a.value.trim(),{isValid:l,discountType:d,amount:c}=await e(r);if(!l){i.textContent="Nieprawid\u0142owy kupon.",i.style.display="block",i.style.color="#b42318",i.classList.remove("hide");return}let u=d==="fixed"?`Zni\u017Cka: ${(c/100).toFixed(2)} z\u0142`:`Zni\u017Cka: ${c}%`;i.innerHTML=`Kupon zosta\u0142 dodany. ${u}<br/>Cena zostanie zrabatowana w kolejnym kroku.`,i.style.display="block",i.style.color="#027a48",i.classList.remove("hide");let y=C(o,0);s=d==="percentage"?Number(y)*(c/100):c/100}),I(o,1),X?.addEventListener("click",async()=>{if(!Y()||!U())return;let a=J();await ne(a);let i=await E();I(i,2);let r=C(i,0),l=C(i,s),d=(Number(l)*.23).toFixed(2);if(l=(Number(l)*1.23).toFixed(2),Number(l)<=2){alert("Suma produkt\xF3w w koszyku musi wynosi\u0107 wi\u0119cej ni\u017C 2.00 z\u0142, aby kontynuowa\u0107.");return}k(Number(r),Number(d),Number(l),Number(s)),await ee();let c=await _(),u=await te(Number(r),Number(d),Number(l),Number(s),i,{...a,address_line1:a.addressLine1,address_line2:a.addressLine2,city:a.city,state:a.state,postal_code:a.postalCode,country:a.country},c);if(!u){console.error("Payment intent is missing.");return}let y=document.querySelector('[data-element="stripe"]');if(!y){console.error("Stripe element could not be found. Ensure that the element has the correct data-element attribute.");return}let v=t.elements({clientSecret:u.client_secret});v.create("payment").mount(y);let p="https://petroleo-wf-dev.webflow.io/potwierdzenie-zamowienia";n.addEventListener("submit",async m=>{m.preventDefault(),m.stopPropagation(),await v.submit();let z=await t.confirmPayment({elements:v,clientSecret:u.client_secret,redirect:"always",confirmParams:{return_url:p}}),w=document.querySelector(".w-form-done"),h=document.querySelector(".w-form-fail"),M=document.querySelector(".container-medium");z.error?(h&&(h.textContent=`P\u0142atno\u015B\u0107 nieudana: ${z.error.message}`,h.style.display="block"),w&&(w.style.display="none")):(w&&(w.textContent="P\u0142atno\u015B\u0107 zako\u0144czona sukcesem!",w.style.display="block"),h&&(h.style.display="none"),M&&(M.style.display="none"))},!0)})};document.addEventListener("DOMContentLoaded",ae);var re=()=>{let t=document.querySelector("#Email"),n=document.querySelector("#wf-ecom-shipping-name"),o=document.querySelector("#nip"),e=document.querySelector("#Telefon"),s=document.querySelector("#DodatkoweInformacje"),a=document.querySelector("#nazwa-firmy");return{email:t,name:n,nip:o,phone:e,additionalInfo:s,companyName:a}},oe=async()=>{try{let t=new URLSearchParams(window.location.search),n=t.get("redirect_status")??"",o=t.get("payment_intent")??"";if(n==="succeeded"&&o){let e=await L(o);if(!e){alert("Wyst\u0105pi\u0142 b\u0142\u0105d podczas pobierania informacji o zamiarze zap\u0142aty. Skontaktuj si\u0119 z nami w celu wyja\u015Bnienia sytuacji."),console.error("Error retrieving payment intent.");return}console.log("Order Details:",e);let s=[];try{s=JSON.parse(e.metadata.items)}catch(i){console.error("Error parsing items from metadata:",i),alert("Wyst\u0105pi\u0142 b\u0142\u0105d podczas przetwarzania informacji o zam\xF3wieniu.");return}await j(),A(s);let a=re();if(a){let{email:i,name:r,nip:l,phone:d,additionalInfo:c,companyName:u}=a;i&&(i.textContent=e.receipt_email||""),r&&(r.textContent=e.shipping.name||""),d&&(d.textContent=e.shipping.phone||""),c&&(c.textContent=e.metadata.additional_info||"-"),l&&(e.metadata.nip?l.textContent=e.metadata.nip:l.parentElement?.remove()),u&&(e.metadata.company_name?u.textContent=e.metadata.company_name:u.parentElement?.remove()),window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"purchase",ecommerce:{transaction_id:e.id,affiliation:"Konferencja App",value:e.metadata.total_amount/100,currency:"PLN",tax:e.metadata.tax_cost/100,discount:e.metadata.coupon_amount/100,items:s.map(y=>({item_id:y.id,item_name:y.id,affiliation:"Konferencja App",price:y.price,quantity:y.quantity}))}}),k(e.metadata.products_cost/100,e.metadata.tax_cost/100,e.metadata.total_amount/100,e.metadata.coupon_amount/100)}}else if(n==="pending")alert("Twoje zam\xF3wienie jest nadal przetwarzane. Kliknij OK, aby strona od\u015Bwie\u017Cy\u0142a si\u0119 w przeci\u0105gu 10 sekund, aby sprawdzi\u0107 ponownie status."),setTimeout(async()=>{let e=await L(o);if(!e){alert("Wyst\u0105pi\u0142 b\u0142\u0105d podczas pobierania informacji o p\u0142atno\u015Bci.");return}if(e.status==="succeeded"){t.set("redirect_status","succeeded");let s=`${window.location.pathname}?${t.toString()}`;window.location.replace(s)}else if(e.status==="requires_payment_method"){alert("Nie doko\u0144czy\u0142e\u015B p\u0142atno\u015Bci. Kliknij OK, aby spr\xF3bowa\u0107 jeszcze raz.");let s=`${window.location.origin}/koszyk`;window.location.replace(s)}},1e4);else if(n==="cancelled"){alert("Anulowa\u0142e\u015B p\u0142atno\u015B\u0107. Spr\xF3buj jeszcze raz. Kliknij OK, aby nast\u0105pi\u0142o przekierowanie.");let e=`${window.location.origin}/koszyk`;window.location.replace(e)}}catch(t){alert("Wyst\u0105pi\u0142 b\u0142\u0105d. Skontaktuj si\u0119 z nami w celu wyja\u015Bnienia sytuacji."),console.error("Error retrieving order details:",t)}};document.addEventListener("DOMContentLoaded",oe);})();
