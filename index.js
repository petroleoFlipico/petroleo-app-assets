"use strict";(()=>{var m=document.querySelector("#cart-button"),l=document.querySelector("#added-to-cart"),v={};async function h(){try{let e=await(await fetch("https://petroleo-app.onrender.com/api/cart",{credentials:"include"})).json();if(!Array.isArray(e))throw new Error("Received data is not an array");return e}catch(a){return console.error("Failed to fetch cart items:",a),[]}}async function c(){m?.classList.remove("hide");let a=document.querySelector(".state-default"),e=document.querySelector(".state-empty"),n=document.querySelector(".state-error");try{let t=await h(),r=t.reduce((s,d)=>s+d.price*d.quantity,0),i=document.getElementById("cart-total");i&&(i.style.display="block",i.textContent=`${r.toFixed(2)} z\u0142 + VAT`);let o=document.getElementById("cart-quantity");if(o){let s=t.reduce((d,y)=>d+y.quantity,0);o.textContent=s.toString()}a&&e&&n&&(t.length>0?(e.style.display="none",n.style.display="none",a.style.display="block"):(a.style.display="none",n.style.display="none",e.style.display="flex")),await T(t)}catch(t){console.error("Failed to update cart UI:",t),a&&e&&n&&(e.style.display="none",a.style.display="none",n.style.display="flex")}}async function f(a){let e=a.closest(".pricing19_plan")||a.closest(".home_pricing_plan");if(!e){console.error("Product element not found");return}let n=a.getAttribute("ticket-type");if(!n){console.error("Invalid or missing ticket type:",n),alert("Nieprawid\u0142owy typ biletu. Prosz\u0119 wybra\u0107 ponownie.");return}let t=e.querySelector('select[data-input="variant"]'),r=null;if(t&&t.getAttribute("validate")==="true"){if(t.value===""){alert("Prosz\u0119 wybra\u0107 opcj\u0119 przed dodaniem produktu do koszyka.");return}r=t.value}let i=1,o=e.querySelector('input[data-input="quantity"]');i=o&&o.value.trim()!==""?parseInt(o.value,10):1;try{await w({ticketType:n,variant:r||null,quantity:i})}catch(s){console.error("Error getting selected item:",s)}}async function w(a){try{let e=await fetch("https://petroleo-app.onrender.com/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!e.ok)throw new Error(`Failed to add item to cart: ${e.statusText}`);let t=(await e.json()).find(r=>r.ticketType===a.ticketType&&(r.variant??null)===(a.variant??null));t&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"add_to_cart",ecommerce:{currency:"PLN",value:t.price*t.quantity,items:[{item_id:t.id,item_name:t.id,affiliation:"Konferencja App",price:t.price,quantity:t.quantity}]}})),await c(),l&&(l.style.display="flex",l.style.opacity="0",l.style.transition="opacity 0.5s ease",setTimeout(()=>{l.style.opacity="1"},10),setTimeout(()=>{l.style.opacity="0",setTimeout(()=>{l.style.display="none"},500)},1500))}catch(e){console.error("Failed to add item to cart:",e)}}var p=()=>{document.querySelectorAll('a[data-input="addtocart"]').forEach(e=>{e.dataset.listenerAdded!=="true"&&(e.addEventListener("click",async n=>{n.preventDefault();try{await f(e)}catch(t){console.error("Error adding to cart:",t)}}),e.dataset.listenerAdded="true")})};async function b(a,e=null){try{let n=e==="null"?null:e,t=await fetch(`https://petroleo-app.onrender.com/api/cart/${a}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({variant:n})});if(!t.ok)throw new Error(`Failed to remove item: ${t.statusText}`);window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"remove_from_cart",ecommerce:{items:[{item_id:a,item_name:a,affiliation:"Konferencja App"}]}}),await c()}catch(n){console.error("Failed to remove item from cart:",n)}}async function g(a,e,n=null){try{let t=await fetch(`https://petroleo-app.onrender.com/api/cart/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({variant:n==="null"?null:n,quantity:e,attendeeName:v[a]||[]})});if(!t.ok)throw new Error(`Failed to update item quantity: ${t.statusText}`);window.location.href.includes("koszyk")||await c()}catch(t){console.error("Failed to update item quantity:",t)}}function E(){document.addEventListener("change",async a=>{let e=a.target;if(!e.classList.contains("is-quantity"))return;let n=parseInt(e.value,10),t=e.closest(".cart-item"),r=t?.querySelector(".deletebutton")?.getAttribute("data-item-id"),i=t?.querySelector(".deletebutton")?.getAttribute("data-variant")||null;r&&n>0&&await g(r,n,i)})}async function T(a){let e=document.querySelector(".cart-list");if(!e)return;e.innerHTML="",a.forEach((t,r)=>{let i=document.createElement("div");i.className="cart-item",i.innerHTML=`
            <div class="cart-product-info" style="white-space: nowrap">
                <div class="margin-bottom margin-custom5">    
                    <span class="text-weight-semibold text-style-2lines" style="text-wrap: initial">${t.ticketType.toUpperCase()}</span>
                </div>
                <div class="cart-product-parameter" style="display: ${t.variant!==null?"flex":"none"}">
                    <div class="display-inline">Wariant:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${t.variant}</div>
                </div>
                
                <div class="cart-product-parameter">
                    <div class="display-inline">Cena:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${t.price} z\u0142 + VAT</div>
                </div>

                <div class="cart-product-parameter">
                    <div class="display-inline">Ilo\u015B\u0107:</div>
                    <div class="display-inline text-weight-semibold text-color-brand">&nbsp;${t.quantity}</div>
                </div>
            </div>
            <div class="card-product-form w-form">
                <input class="form_input is-quantity w-input" data-input="quantity" maxlength="256" value="${t.quantity}" type="number">
            </div>
            <button class="button-6 deletebutton" data-item-id="${t.id}" data-variant="${t.variant}">
                <div class="icon-1x1-xsmall">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M18 6l-12 12"></path>
                        <path d="M6 6l12 12"></path>
                    </svg>
                </div>
            </button>
        `,e.appendChild(i)}),E(),document.querySelectorAll(".deletebutton").forEach(t=>{t.addEventListener("click",async r=>{let i=r.currentTarget,o=i.getAttribute("data-item-id"),s=i.getAttribute("data-variant")||null;o?await b(o,s):console.error("Failed to remove item from cart: missing item ID")})})}async function u(){await c()}window.Webflow||=[];window.Webflow.push(async()=>{try{await u(),await p()}catch(a){console.error("B\u0142\u0105d podczas obs\u0142ugi Webflow:",a)}});})();
